<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Alias Game Test</title>
    <style>
        body { font-family: Arial, sans-serif; }
        section { margin-bottom: 20px; }
        #messages { border: 1px solid #ccc; padding: 10px; height: 150px; overflow-y: auto; }
    </style>
</head>
<body>
<h1>Alias Game Test</h1>
<section>
    <h2>Create Game</h2>
    <textarea id="words" rows="4" cols="50" placeholder="comma separated words"></textarea><br>
    <button id="create">Create</button>
    <div id="gameId"></div>
</section>
<section>
    <h2>Host Game</h2>
    <input id="hostGameId" placeholder="game id">
    <button id="connectHost">Connect</button>
    <button id="skip" disabled>Skip</button>
    <div id="currentWord"></div>
    <div id="expires"></div>
</section>
<section>
    <h2>Join as Player</h2>
    <input id="playerName" placeholder="your name">
    <input id="playerGameId" placeholder="game id">
    <button id="join">Join</button><br>
    <input id="guessInput" placeholder="your guess" disabled>
    <button id="sendGuess" disabled>Guess</button>
    <div id="scores"></div>
</section>
<pre id="messages"></pre>
<script>
const hostUrl = "ws://localhost:8000/api/game/";
let hostSocket = null;
let playerSocket = null;

document.getElementById('create').onclick = async () => {
    const words = document.getElementById('words').value.split(',').map(w => w.trim()).filter(Boolean);
    const res = await fetch('http://localhost:8000/api/game/create', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ remaining_words: words })
    });
    const data = await res.json();
    document.getElementById('gameId').textContent = 'Game ID: ' + data.id;
    document.getElementById('hostGameId').value = data.id;
    document.getElementById('playerGameId').value = data.id;
};

document.getElementById('connectHost').onclick = () => {
    const id = document.getElementById('hostGameId').value.trim();
    if (!id) return;
    hostSocket = new WebSocket(hostUrl + id);
    hostSocket.onmessage = evt => {
        const data = JSON.parse(evt.data);
        document.getElementById('currentWord').textContent = 'Word: ' + (data.current_word || '');
        document.getElementById('expires').textContent = data.expires_at ? 'Expires: ' + data.expires_at : '';
        document.getElementById('skip').disabled = !data.current_word;
        log('Host state: ' + evt.data);
    };
    hostSocket.onopen = () => log('Host connected');
    hostSocket.onclose = () => log('Host disconnected');
};

document.getElementById('skip').onclick = () => {
    if (hostSocket) hostSocket.send(JSON.stringify({ action: 'skip' }));
};

document.getElementById('join').onclick = () => {
    const id = document.getElementById('playerGameId').value.trim();
    const name = document.getElementById('playerName').value.trim();
    if (!id || !name) return;
    playerSocket = new WebSocket(hostUrl + id + '/player?name=' + encodeURIComponent(name));
    playerSocket.onmessage = evt => {
        const data = JSON.parse(evt.data);
        document.getElementById('scores').textContent = 'Scores: ' + JSON.stringify(data.scores || {});
        log('Player state: ' + evt.data);
    };
    playerSocket.onopen = () => {
        document.getElementById('guessInput').disabled = false;
        document.getElementById('sendGuess').disabled = false;
        document.getElementById('guessInput').focus();
        log('Player connected');
    };
    playerSocket.onclose = () => {
        document.getElementById('guessInput').disabled = true;
        document.getElementById('sendGuess').disabled = true;
        log('Player disconnected');
    };
};

document.getElementById('sendGuess').onclick = () => {
    const guess = document.getElementById('guessInput').value.trim();
    if (playerSocket && guess) {
        playerSocket.send(JSON.stringify({ action: 'guess', guess }));
        document.getElementById('guessInput').value = '';
    }
};

document.getElementById('guessInput').addEventListener('keyup', evt => {
    if (evt.key === 'Enter') {
        document.getElementById('sendGuess').click();
    }
});

function log(msg) {
    const pre = document.getElementById('messages');
    pre.textContent += msg + '\n';
    pre.scrollTop = pre.scrollHeight;
}
</script>
</body>
</html>